package thminiprojthebook.demo;

import thminiprojthebook.domain.*;
import thminiprojthebook.test.AiTestConfig;
import java.util.Date;

/**
 * AI ì–´ê·¸ë¦¬ê²Œì´íŠ¸ ë…ë¦½ ë°ëª¨ í´ë˜ìŠ¤
 * - ë‹¤ë¥¸ ì–´ê·¸ë¦¬ê²Œì´íŠ¸ì— ì˜ì¡´í•˜ì§€ ì•Šê³  AI ê¸°ëŠ¥ë§Œ í…ŒìŠ¤íŠ¸
 * - ì»¤ë²„ ìƒì„± ë° ì´ë²¤íŠ¸ ë°œí–‰ ê³¼ì • ì‹œì—°
 */
public class AiAggregateDemo {
    
    public static void main(String[] args) {
        System.out.println("=== AI ì–´ê·¸ë¦¬ê²Œì´íŠ¸ ë…ë¦½ í…ŒìŠ¤íŠ¸ ì‹œì‘ ===\n");
        
        // 1. BookRegisted ì´ë²¤íŠ¸ ì‹œë®¬ë ˆì´ì…˜
        BookRegisted bookEvent = createTestBookEvent();
        displayBookEvent(bookEvent);
        
        // 2. CoverDesign ìƒì„± ê³¼ì • ì‹œë®¬ë ˆì´ì…˜
        CoverDesign coverDesign = simulateCoverGeneration(bookEvent);
        displayCoverDesign(coverDesign);
        
        // 3. CoverCreated ì´ë²¤íŠ¸ ìƒì„±
        CoverCreated coverCreatedEvent = createCoverCreatedEvent(coverDesign);
        displayCoverCreatedEvent(coverCreatedEvent);
        
        // 4. AiProcessTracker ìƒíƒœ ì¶”ì 
        AiProcessTracker tracker = simulateProcessTracking(bookEvent, coverDesign);
        displayProcessTracker(tracker);
        
        // 5. ì „ì²´ í”„ë¡œì„¸ìŠ¤ ì™„ë£Œ ì´ë²¤íŠ¸
        BookAiProcessCompleted completedEvent = createCompletedEvent(tracker);
        displayCompletedEvent(completedEvent);
        
        System.out.println("\n=== AI ì–´ê·¸ë¦¬ê²Œì´íŠ¸ ë…ë¦½ í…ŒìŠ¤íŠ¸ ì™„ë£Œ ===");
    }
    
    private static BookRegisted createTestBookEvent() {
        BookRegisted event = new BookRegisted();
        event.setBookId(1001L);
        event.setTitle("ë””ì§€í„¸ í˜ì‹ ê³¼ AIì˜ ë¯¸ë˜");
        event.setContext("4ì°¨ ì‚°ì—…í˜ëª… ì‹œëŒ€, ì¸ê³µì§€ëŠ¥ê³¼ ë””ì§€í„¸ ê¸°ìˆ ì´ ê°€ì ¸ì˜¬ ì‚¬íšŒ ë³€í™”ë¥¼ ì˜ˆì¸¡í•˜ê³  ëŒ€ì‘ ë°©ì•ˆì„ ì œì‹œí•˜ëŠ” ì‹¤ìš©ì„œì…ë‹ˆë‹¤. ë¸”ë¡ì²´ì¸, IoT, ë¹…ë°ì´í„°ì™€ AIì˜ ìœµí•©ì„ ë‹¤ë£¹ë‹ˆë‹¤.");
        event.setAuthorId(2001L);
        event.setRegistration(true);
        return event;
    }
    
    private static void displayBookEvent(BookRegisted event) {
        System.out.println("ğŸ“š BookRegisted ì´ë²¤íŠ¸ ìˆ˜ì‹ ");
        System.out.println("   Book ID: " + event.getBookId());
        System.out.println("   Title: " + event.getTitle());
        System.out.println("   Author ID: " + event.getAuthorId());
        System.out.println("   Context ê¸¸ì´: " + event.getContext().length() + " ë¬¸ì");
        System.out.println();
    }
    
    private static CoverDesign simulateCoverGeneration(BookRegisted event) {
        System.out.println("ğŸ¨ ì»¤ë²„ ë””ìì¸ ìƒì„± ê³¼ì • ì‹œë®¬ë ˆì´ì…˜");
        
        // Mock DalleService ì‚¬ìš©
        AiTestConfig.MockDalleService mockService = new AiTestConfig.MockDalleService();
        String imageUrl = mockService.generateCoverImage(event.getTitle(), event.getContext());
        
        CoverDesign coverDesign = new CoverDesign();
        coverDesign.setId(1L);
        coverDesign.setAuthorId(event.getAuthorId());
        coverDesign.setBookId(event.getBookId().toString());
        coverDesign.setTitle(event.getTitle());
        coverDesign.setImageUrl(imageUrl);
        coverDesign.setGeneratedBy("DALL-E-3");
        coverDesign.setCreatedAt(new Date());
        coverDesign.setUpdatedAt(new Date());
        
        return coverDesign;
    }
    
    private static void displayCoverDesign(CoverDesign coverDesign) {
        System.out.println("âœ… ì»¤ë²„ ë””ìì¸ ìƒì„± ì™„ë£Œ");
        System.out.println("   ID: " + coverDesign.getId());
        System.out.println("   Title: " + coverDesign.getTitle());
        System.out.println("   Image URL: " + coverDesign.getImageUrl());
        System.out.println("   Generated By: " + coverDesign.getGeneratedBy());
        System.out.println("   Created At: " + coverDesign.getCreatedAt());
        System.out.println();
    }
    
    private static CoverCreated createCoverCreatedEvent(CoverDesign coverDesign) {
        CoverCreated event = new CoverCreated(coverDesign);
        event.setId(coverDesign.getId());
        event.setAuthorId(coverDesign.getAuthorId());
        event.setBookId(coverDesign.getBookId());
        event.setTitle(coverDesign.getTitle());
        event.setImageUrl(coverDesign.getImageUrl());
        event.setGeneratedBy(coverDesign.getGeneratedBy());
        event.setCreatedAt(coverDesign.getCreatedAt().toString());
        return event;
    }
    
    private static void displayCoverCreatedEvent(CoverCreated event) {
        System.out.println("ğŸ“¤ CoverCreated ì´ë²¤íŠ¸ ë°œí–‰");
        System.out.println("   Event Type: " + event.getClass().getSimpleName());
        System.out.println("   Book ID: " + event.getBookId());
        System.out.println("   Title: " + event.getTitle());
        System.out.println("   Image URL: " + event.getImageUrl());
        System.out.println("   Generated By: " + event.getGeneratedBy());
        System.out.println();
    }
    
    private static AiProcessTracker simulateProcessTracking(BookRegisted bookEvent, CoverDesign coverDesign) {
        System.out.println("ğŸ“Š AI í”„ë¡œì„¸ìŠ¤ ì¶”ì  ì‹œë®¬ë ˆì´ì…˜");
        
        AiProcessTracker tracker = new AiProcessTracker();
        tracker.setBookId(bookEvent.getBookId().toString());
        tracker.setTitle(bookEvent.getTitle());
        tracker.setAuthorId(bookEvent.getAuthorId());
        
        // ì»¤ë²„ ìƒì„± ì™„ë£Œ í‘œì‹œ
        tracker.markCoverGenerationCompleted(coverDesign.getImageUrl(), coverDesign.getGeneratedBy());
        
        // ì»¨í…ì¸  ë¶„ì„ë„ ì™„ë£Œ í‘œì‹œ (ì‹œë®¬ë ˆì´ì…˜)
        tracker.markContentAnalysisCompleted(
            "ë””ì§€í„¸ í˜ì‹ ê³¼ AI ê¸°ìˆ ì˜ ìœµí•©ì„ ë‹¤ë£¨ëŠ” ì‹¤ìš©ì  ê°€ì´ë“œë¶",
            "Technology/Business",
            "Korean",
            1500
        );
        
        return tracker;
    }
    
    private static void displayProcessTracker(AiProcessTracker tracker) {
        System.out.println("âœ… AI í”„ë¡œì„¸ìŠ¤ ì¶”ì  ìƒíƒœ");
        System.out.println("   Book: " + tracker.getTitle());
        System.out.println("   Cover Generation: " + (tracker.getCoverGenerationCompleted() ? "âœ…" : "â³"));
        System.out.println("   Content Analysis: " + (tracker.getContentAnalysisCompleted() ? "âœ…" : "â³"));
        System.out.println("   Classification: " + tracker.getClassificationType());
        System.out.println("   Summary: " + tracker.getSummary());
        System.out.println("   Completed At: " + tracker.getCompletedAt());
        System.out.println();
    }
    
    private static BookAiProcessCompleted createCompletedEvent(AiProcessTracker tracker) {
        BookAiProcessCompleted event = new BookAiProcessCompleted();
        event.setAuthorId(tracker.getAuthorId());
        event.setBookId(tracker.getBookId());
        event.setTitle(tracker.getTitle());
        
        // Content Analysis ë°ì´í„°
        event.setSummary(tracker.getSummary());
        event.setClassificationType(tracker.getClassificationType());
        event.setLanguage(tracker.getLanguage());
        event.setMaxLength(tracker.getMaxLength());
        
        // Cover Design ë°ì´í„°
        event.setImageUrl(tracker.getImageUrl());
        event.setGeneratedBy(tracker.getGeneratedBy());
        event.setCoverCreatedAt(tracker.getCreatedAt());
        
        // ìƒíƒœ í”Œë˜ê·¸
        event.setContentAnalysisCompleted(tracker.getContentAnalysisCompleted());
        event.setCoverGenerationCompleted(tracker.getCoverGenerationCompleted());
        event.setCompletedAt(tracker.getCompletedAt());
        
        return event;
    }
    
    private static void displayCompletedEvent(BookAiProcessCompleted event) {
        System.out.println("ğŸ‰ BookAiProcessCompleted í†µí•© ì´ë²¤íŠ¸ ë°œí–‰");
        System.out.println("   Book: " + event.getTitle());
        System.out.println("   Author ID: " + event.getAuthorId());
        System.out.println("   Summary: " + event.getSummary());
        System.out.println("   Classification: " + event.getClassificationType());
        System.out.println("   Language: " + event.getLanguage());
        System.out.println("   Cover URL: " + event.getImageUrl());
        System.out.println("   Generated By: " + event.getGeneratedBy());
        System.out.println("   All Processes Completed: " + 
            (event.getContentAnalysisCompleted() && event.getCoverGenerationCompleted() ? "âœ…" : "âŒ"));
        System.out.println();
    }
}
